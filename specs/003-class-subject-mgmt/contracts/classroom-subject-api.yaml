# API Contract: Grade and Subject Management System

## Base Response Format
All API endpoints return responses in the following format using the existing `Result<T>` class:

```json
{
  "data": {},
  "code": 0,
  "msg": "success"
}
```

Where:
- `data`: Contains the response payload (varies by endpoint)
- `code`: Numeric status code (0 for success, specific error codes for failures)
- `msg`: Human-readable message describing the result

## Error Codes
- `0`: Success
- `1001`: Validation Error
- `1002`: Invalid Request Parameter
- `2001`: Unauthorized Access
- `2002`: Insufficient Permissions
- `2003`: Authentication Required
- `3001`: Internal Server Error
- `3002`: Service Unavailable
- `4001`: Resource Not Found
- `4002`: Resource Already Exists

## Education Level Management APIs

### List Education Levels
- **Endpoint**: `GET /api/education-level/list`
- **Description**: Retrieve all available education levels
- **Authentication**: Required
- **Permissions**: `education-level:read`
- **Response**:
```json
{
  "data": [
    {
      "id": "level_001",
      "name": "Kindergarten",
      "code": "KINDERGARTEN",
      "sortOrder": 1,
      "description": "Early childhood education",
      "status": "ACTIVE"
    }
  ],
  "code": 0,
  "msg": "Education levels retrieved successfully"
}
```

## Grade Management APIs

### List Grades with Pagination
- **Endpoint**: `POST /api/grade/list`
- **Description**: Retrieve paginated list of grades with filtering options
- **Authentication**: Required
- **Permissions**: `grade:read`
- **Request Body**:
```json
{
  "page": 1,
  "size": 10,
  "sortField": "createTime",
  "sortOrder": "desc",
  "filters": {
    "educationLevelId": "level_001",
    "status": "ACTIVE",
    "gradeNumber": 1
  }
}
```
- **Response**:
```json
{
  "data": {
    "records": [
      {
        "id": "grade_001",
        "name": "Grade 1",
        "code": "ES_GRADE_1",
        "educationLevelId": "level_002",
        "educationLevelName": "Elementary School",
        "gradeNumber": 1,
        "capacity": 30,
        "currentEnrollment": 25,
        "status": "ACTIVE",
        "description": "Elementary Grade 1 class"
      }
    ],
    "total": 150,
    "current": 1,
    "size": 10,
    "pages": 15
  },
  "code": 0,
  "msg": "Grades retrieved successfully"
}
```

### Get Grade by ID
- **Endpoint**: `GET /api/grade/{id}`
- **Description**: Retrieve a specific grade by ID
- **Authentication**: Required
- **Permissions**: `grade:read`
- **Response**:
```json
{
  "data": {
    "id": "grade_001",
    "name": "Grade 1",
    "code": "ES_GRADE_1",
    "educationLevelId": "level_002",
    "educationLevelName": "Elementary School",
    "gradeNumber": 1,
    "classType": null,
    "capacity": 30,
    "currentEnrollment": 25,
    "status": "ACTIVE",
    "description": "Elementary Grade 1 class",
    "createTime": "2026-01-17T10:00:00",
    "updateTime": "2026-01-17T10:00:00"
  },
  "code": 0,
  "msg": "Grade retrieved successfully"
}
```

### Create Grade
- **Endpoint**: `POST /api/grade/create`
- **Description**: Create a new grade
- **Authentication**: Required
- **Permissions**: `grade:create` (restricted to Principal/Super Admin)
- **Request Body**:
```json
{
  "name": "Grade 2",
  "code": "ES_GRADE_2",
  "educationLevelId": "level_002",
  "gradeNumber": 2,
  "classType": null,
  "capacity": 30,
  "description": "Elementary Grade 2 class"
}
```
- **Response**:
```json
{
  "data": {
    "id": "grade_new",
    "createTime": "2026-01-17T10:00:00"
  },
  "code": 0,
  "msg": "Grade created successfully"
}
```

### Update Grade
- **Endpoint**: `PUT /api/grade/update`
- **Description**: Update an existing grade
- **Authentication**: Required
- **Permissions**: `grade:update` (restricted to Principal/Super Admin)
- **Request Body**:
```json
{
  "id": "grade_001",
  "name": "Updated Grade 1",
  "capacity": 35,
  "status": "ACTIVE"
}
```
- **Response**:
```json
{
  "data": {
    "id": "grade_001",
    "updateTime": "2026-01-17T10:00:00"
  },
  "code": 0,
  "msg": "Grade updated successfully"
}
```

### Delete Grade
- **Endpoint**: `DELETE /api/grade/delete/{id}`
- **Description**: Delete a grade
- **Authentication**: Required
- **Permissions**: `grade:delete` (restricted to Principal/Super Admin)
- **Response**:
```json
{
  "data": null,
  "code": 0,
  "msg": "Grade deleted successfully"
}
```

## Subject Management APIs

### List Subjects with Pagination
- **Endpoint**: `POST /api/subject/list`
- **Description**: Retrieve paginated list of subjects with filtering options
- **Authentication**: Required
- **Permissions**: `subject:read`
- **Request Body**:
```json
{
  "page": 1,
  "size": 10,
  "sortField": "sortOrder",
  "sortOrder": "asc",
  "filters": {
    "educationLevelId": "level_002",
    "status": "ACTIVE",
    "subjectCategory": "CORE"
  }
}
```
- **Response**:
```json
{
  "data": {
    "records": [
      {
        "id": "subj_001",
        "name": "Mathematics",
        "code": "MATH",
        "educationLevelId": "level_002",
        "educationLevelName": "Elementary School",
        "subjectCategory": "CORE",
        "credits": 4,
        "status": "ACTIVE",
        "sortOrder": 2,
        "description": "Elementary Mathematics"
      }
    ],
    "total": 50,
    "current": 1,
    "size": 10,
    "pages": 5
  },
  "code": 0,
  "msg": "Subjects retrieved successfully"
}
```

### Get Subject by ID
- **Endpoint**: `GET /api/subject/{id}`
- **Description**: Retrieve a specific subject by ID
- **Authentication**: Required
- **Permissions**: `subject:read`
- **Response**:
```json
{
  "data": {
    "id": "subj_001",
    "name": "Mathematics (Science)",
    "code": "MATH_SCIENCE",
    "educationLevelId": "level_004",
    "educationLevelName": "High School",
    "subjectCategory": "CORE",
    "credits": 4,
    "status": "ACTIVE",
    "sortOrder": 2,
    "description": "Advanced Mathematics for Science Stream",
    "createTime": "2026-01-17T10:00:00",
    "updateTime": "2026-01-17T10:00:00"
  },
  "code": 0,
  "msg": "Subject retrieved successfully"
}
```

### Create Subject
- **Endpoint**: `POST /api/subject/create`
- **Description**: Create a new subject
- **Authentication**: Required
- **Permissions**: `subject:create` (restricted to Principal/Super Admin)
- **Request Body**:
```json
{
  "name": "Physics",
  "code": "PHYSICS",
  "educationLevelId": "level_004",
  "subjectCategory": "SCIENCE",
  "credits": 4,
  "sortOrder": 3,
  "description": "High School Physics"
}
```
- **Response**:
```json
{
  "data": {
    "id": "subj_new",
    "createTime": "2026-01-17T10:00:00"
  },
  "code": 0,
  "msg": "Subject created successfully"
}
```

### Update Subject
- **Endpoint**: `PUT /api/subject/update`
- **Description**: Update an existing subject
- **Authentication**: Required
- **Permissions**: `subject:update` (restricted to Principal/Super Admin)
- **Request Body**:
```json
{
  "id": "subj_001",
  "name": "Updated Mathematics",
  "credits": 5,
  "status": "ACTIVE"
}
```
- **Response**:
```json
{
  "data": {
    "id": "subj_001",
    "updateTime": "2026-01-17T10:00:00"
  },
  "code": 0,
  "msg": "Subject updated successfully"
}
```

### Delete Subject
- **Endpoint**: `DELETE /api/subject/delete/{id}`
- **Description**: Delete a subject
- **Authentication**: Required
- **Permissions**: `subject:delete` (restricted to Principal/Super Admin)
- **Response**:
```json
{
  "data": null,
  "code": 0,
  "msg": "Subject deleted successfully"
}
```

## Data Import/Export APIs

### Import Grades from File
- **Endpoint**: `POST /api/grade/import`
- **Description**: Import grade data from uploaded file (CSV/JSON)
- **Authentication**: Required
- **Permissions**: `grade:import` (restricted to Principal/Super Admin)
- **Request**: Multipart form data with file
- **Response**:
```json
{
  "data": {
    "importId": "imp_001",
    "totalRecords": 100,
    "successfulImports": 95,
    "failedImports": 5,
    "errors": [
      {
        "row": 10,
        "error": "Invalid education level ID"
      }
    ]
  },
  "code": 0,
  "msg": "Grade import completed"
}
```

### Import Subjects from File
- **Endpoint**: `POST /api/subject/import`
- **Description**: Import subject data from uploaded file (CSV/JSON)
- **Authentication**: Required
- **Permissions**: `subject:import` (restricted to Principal/Super Admin)
- **Request**: Multipart form data with file
- **Response**:
```json
{
  "data": {
    "importId": "imp_002",
    "totalRecords": 80,
    "successfulImports": 80,
    "failedImports": 0,
    "errors": []
  },
  "code": 0,
  "msg": "Subject import completed successfully"
}
```

### Export Grades to File
- **Endpoint**: `POST /api/grade/export`
- **Description**: Export grade data to file (CSV/JSON)
- **Authentication**: Required
- **Permissions**: `grade:export` (restricted to Principal/Super Admin)
- **Request Body**:
```json
{
  "format": "csv",  // or "json"
  "filters": {
    "educationLevelId": "level_002",
    "status": "ACTIVE"
  }
}
```
- **Response**: File download with appropriate content-type header

### Export Subjects to File
- **Endpoint**: `POST /api/subject/export`
- **Description**: Export subject data to file (CSV/JSON)
- **Authentication**: Required
- **Permissions**: `subject:export` (restricted to Principal/Super Admin)
- **Request Body**:
```json
{
  "format": "json",  // or "csv"
  "filters": {
    "educationLevelId": "level_004",
    "status": "ACTIVE"
  }
}
```
- **Response**: File download with appropriate content-type header

## Role-Based Access Control

### Permission Requirements
- Grade/Subject CREATE, UPDATE, DELETE operations require `Principal` or `Super Admin` roles
- Grade/Subject READ operations are available to all authenticated users
- Import/Export operations require `Principal` or `Super Admin` roles
- Administrative operations (deactivate education levels) require `Super Admin` role

### Annotation-Based Permissions
Controllers use `@PermissionRequired` annotation for fine-grained access control:

```java
@PermissionRequired(
    menu = "grade-management", 
    button = "create-grade", 
    operation = "CREATE"
)
@PostMapping("/grade/create")
public Result<Grade> createGrade(@RequestBody GradeDTO gradeDTO) {
    // Implementation
}
```

This will automatically register the permission `grade-management:create-grade:CREATE` in the system.